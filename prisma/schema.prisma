// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
  // uncomment next line if you use Prisma <5.10
  // directUrl = env("DATABASE_URL_UNPOOLED")
}

model Employee {
  id       String @id @default(uuid())
  userId   String @unique
  imageUrl String @db.Text
  name     String
  email    String @unique
  phone    String

  designationId String?
  designation   Designation? @relation(fields: [designationId], references: [id], onDelete: SetNull)

  wrAdded   WorkRequest[]
  verified  DateTime?
  createdAt DateTime      @default(now())
  updatedAt DateTime      @updatedAt
}

model Department {
  id           String        @id @default(uuid())
  name         String        @unique
  shortName    String
  designations Designation[]
}

model Designation {
  id           String     @id @default(uuid())
  title        String
  shortTitle   String
  departmentId String
  department   Department @relation(fields: [departmentId], references: [id], onDelete: Cascade)

  employees Employee[]

  @@unique([departmentId, title])
}

enum Mode {
  NORMAL
  STRICT
}

enum Status {
  PLACED
  PENDING
  ONGOING
  DONE
  UNDER_OBSERVATION
  NOT_SOLVED
  FOLLOW_UP
}

enum WrType {
  ELECTRICAL
  MECHANICAL
}

model Area {
  id       String  @id @default(cuid())
  name     String
  parentId String?
  parent   Area?   @relation("AreaParent", fields: [parentId], references: [id])
  children Area[]  @relation("AreaParent")

  workRequest WorkRequest[]
  createdAt   DateTime      @default(now())
}

model WorkRequest {
  id             String  @id @default(cuid())
  wrNo           String  @unique
  title          String
  type           WrType
  status         Status  @default(PLACED)
  remarks        String?
  mode           Mode    @default(NORMAL)
  runningHour    String?
  referredFromId String?
  creatorId      String
  areaId         String

  creator          Employee      @relation(fields: [creatorId], references: [id])
  area             Area          @relation(fields: [areaId], references: [id])
  referredFrom     WorkRequest?  @relation("ReferredWorkRequest", fields: [referredFromId], references: [id])
  extendedRequests WorkRequest[] @relation("ReferredWorkRequest")
  createdAt        DateTime      @default(now())
  updatedAt        DateTime      @updatedAt
}
